# ================================================================================
# ArbitrageX MySQL 配置文件
# ================================================================================
# 版本: v1.0.0
# 创建日期: 2026-01-08
# 维护人: yangyangyang
# 描述: MySQL 8.0+ 服务器配置，用于 ArbitrageX 套利交易系统
#
# 使用方法:
#   1. Docker: 将此文件挂载到容器的 /etc/mysql/conf.d/custom.cnf
#   2. 本地: 将此文件复制到 /etc/mysql/conf.d/ 或 /etc/my.cnf.d/
#
# 配置说明:
#   - 字符集: utf8mb4 (支持完整的 UTF-8 字符，包括 emoji)
#   - 连接数: 200 (适合中小型应用)
#   - 性能优化: InnoDB 缓冲池 256M
#   - 日志: 慢查询日志和二进制日志
#   - 时区: +08:00 (北京时间)
# ================================================================================

# ================================================================================
# [mysqld] - MySQL 服务器配置
# ================================================================================
# 说明: 这些配置应用于 MySQL 服务器进程
# ================================================================================

[mysqld]

# ------------------------------------------------------------------------------
# 字符集设置
# ------------------------------------------------------------------------------
# 说明: utf8mb4 是 MySQL 推荐的字符集，完全兼容 UTF-8，支持 4 字节字符
# ------------------------------------------------------------------------------

# 服务器默认字符集
character-set-server=utf8mb4

# 服务器默认排序规则 (unicode_ci 表示不区分大小写，支持多语言)
collation-server=utf8mb4_unicode_ci

# 客户端连接默认字符集
init-connect='SET NAMES utf8mb4'

# ------------------------------------------------------------------------------
# 连接设置
# ------------------------------------------------------------------------------
# 说明: 控制客户端连接的数量和错误处理
# ------------------------------------------------------------------------------

# 最大连接数 (根据应用需求调整，建议 200-500)
max_connections=200

# 最大连接错误次数 (超过此次数后主机可能被阻止)
max_connect_errors=1000

# 连接超时时间 (秒，超时未活动的连接将被关闭)
wait_timeout=28800

# 交互式连接超时时间 (秒，适用于 mysql 客户端)
interactive_timeout=28800

# ------------------------------------------------------------------------------
# 性能优化
# ------------------------------------------------------------------------------
# 说明: 调整 InnoDB 缓冲池和其他性能相关参数
# ------------------------------------------------------------------------------

# InnoDB 缓冲池大小 (建议设置为可用内存的 50-70%)
# 此处设置为 256M，适合小型应用
# 如果服务器有更多内存，可以增加到 1G 或更高
innodb_buffer_pool_size=256M

# InnoDB 日志文件大小 (较大的日志可以减少checkpoint频率)
innodb_log_file_size=64M

# InnoDB 刷盘策略
# 0: 每秒刷盘 (性能最好，但可能丢失 1 秒数据)
# 1: 每次事务提交刷盘 (最安全，但性能最差)
# 2: 每次事务提交写入日志，每秒刷盘 (折中方案)
innodb_flush_log_at_trx_commit=2

# InnoDB IO 容量 (影响 I/O 性能，根据磁盘类型调整)
# SSD: 2000, HDD: 200
innodb_io_capacity=2000

# ------------------------------------------------------------------------------
# 慢查询日志
# ------------------------------------------------------------------------------
# 说明: 记录执行时间超过阈值的查询，用于性能分析和优化
# ------------------------------------------------------------------------------

# 启用慢查询日志 (1=启用, 0=禁用)
slow_query_log=1

# 慢查询日志文件路径
slow_query_log_file=/var/lib/mysql/slow.log

# 慢查询阈值 (秒，执行时间超过此值的查询将被记录)
long_query_time=2

# 记录没有使用索引的查询 (1=记录, 0=不记录)
# 注意: 开启此选项会产生大量日志，建议仅在优化时使用
# log_queries_not_using_indexes=1

# ------------------------------------------------------------------------------
# 二进制日志
# ------------------------------------------------------------------------------
# 说明: 用于数据恢复和主从复制
# ------------------------------------------------------------------------------

# 启用二进制日志
log_bin=mysql-bin

# 二进制日志格式 (ROW=行级，最安全; STATEMENT=语句级; MIXED=混合)
binlog_format=ROW

# 二进制日志过期天数 (自动删除超过此天数的日志)
expire_logs_days=7

# ------------------------------------------------------------------------------
# 时区设置
# ------------------------------------------------------------------------------
# 说明: 设置服务器默认时区
# ------------------------------------------------------------------------------

# 设置时区为东八区 (北京时间)
# 可选值: SYSTEM (使用系统时区), 或偏移量如 +08:00
default-time-zone='+08:00'

# ------------------------------------------------------------------------------
# 网络设置
# ------------------------------------------------------------------------------
# 说明: 控制网络连接和端口绑定
# ------------------------------------------------------------------------------

# 监听端口 (默认 3306)
port=3306

# 绑定地址 (0.0.0.0 表示监听所有接口，127.0.0.1 表示仅本地)
bind-address=0.0.0.0

# 最大数据包大小 (字节，影响大字段如 BLOB/TEXT 的传输)
# 设置为 64M，适合大多数应用
max_allowed_packet=67108864

# ------------------------------------------------------------------------------
# 安全设置
# ------------------------------------------------------------------------------
# 说明: 增强安全性的配置
# ------------------------------------------------------------------------------

# 禁用符号链接 (防止安全风险)
symbolic-links=0

# 仅允许本地文件访问 (防止 LOAD DATA INFILE 的安全问题)
local_infile=0

# ------------------------------------------------------------------------------
# 临时表设置
# ------------------------------------------------------------------------------
# 说明: 控制内存临时表的使用
# ------------------------------------------------------------------------------

# 内存临时表最大大小 (字节，超过此大小将转换为磁盘临时表)
tmp_table_size=32M

# 内存堆表最大大小 (字节)
max_heap_table_size=32M

# ================================================================================
# [mysql] - MySQL 客户端配置
# ================================================================================
# 说明: 这些配置应用于 mysql 命令行客户端
# ================================================================================

[mysql]

# 客户端默认字符集
default-character-set=utf8mb4

# ================================================================================
# [client] - 客户端连接配置
# ================================================================================
# 说明: 这些配置应用于所有连接到 MySQL 服务器的客户端
# ================================================================================

[client]

# 客户端默认字符集
default-character-set=utf8mb4

# 默认端口 (如果未在命令行指定)
port=3306

# ================================================================================
# [mysqldump] - mysqldump 工具配置
# ================================================================================
# 说明: 这些配置应用于 mysqldump 备份工具
# ================================================================================

[mysqldump]

# 备份时使用快速转储 (不缓存查询，加快大表备份)
quick

# 允许的最大数据包大小 (与服务器设置一致)
max_allowed_packet=67108864
